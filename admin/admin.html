<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compras InvestHome - Administrador</title>
    <link rel="stylesheet" href="../shared/shared.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div id="view-admin" class="view admin-view">
        <!-- Men√∫ lateral izquierdo -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="admin-sidebar-header">
                <h2 class="admin-sidebar-title">Administraci√≥n</h2>
                <button id="btn-toggle-sidebar" class="icon-btn admin-toggle-btn" aria-label="Expandir/Colapsar men√∫">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
            <nav class="admin-sidebar-nav">
                <button class="admin-nav-item active" data-view="admin-tienda" title="Tienda">
                    <span class="admin-nav-icon">üè™</span>
                    <span class="admin-nav-text">Tienda</span>
                </button>
                <button class="admin-nav-item" data-view="admin-pedidos-especiales" title="Pedidos Especiales">
                    <span class="admin-nav-icon">üì¶</span>
                    <span class="admin-nav-text">Pedidos Especiales</span>
                </button>
                <button class="admin-nav-item" data-view="admin-cuentas" title="Cuentas">
                    <span class="admin-nav-icon">üí≥</span>
                    <span class="admin-nav-text">Cuentas</span>
                </button>
                <button class="admin-nav-item" data-view="admin-historico" title="Hist√≥rico">
                    <span class="admin-nav-icon">üìã</span>
                    <span class="admin-nav-text">Hist√≥rico</span>
                </button>
                <button class="admin-nav-item" data-view="admin-usuarios" title="Gesti√≥n de Usuarios">
                    <span class="admin-nav-icon">üë•</span>
                    <span class="admin-nav-text">Gesti√≥n de Usuarios</span>
                </button>
                <button class="admin-nav-item" data-view="admin-obras" title="Gesti√≥n de Obras">
                    <span class="admin-nav-icon">üèóÔ∏è</span>
                    <span class="admin-nav-text">Gesti√≥n de Obras</span>
                </button>
                <button class="admin-nav-item" data-view="admin-tiendas" title="Gesti√≥n de Tiendas">
                    <span class="admin-nav-icon">üè¨</span>
                    <span class="admin-nav-text">Gesti√≥n de Tiendas</span>
                </button>
            </nav>
            <div class="admin-sidebar-footer">
                <button id="btn-logout-admin" class="admin-nav-item admin-logout-btn" aria-label="Cerrar Sesi√≥n">
                    <span class="admin-nav-icon">üö™</span>
                    <span class="admin-nav-text">Cerrar Sesi√≥n</span>
                </button>
            </div>
        </aside>

        <!-- Contenido principal -->
        <div class="admin-content-wrapper">
            <!-- Vista de Tienda (igual que t√©cnico) -->
            <div id="view-admin-tienda" class="admin-content-view active">
                <header class="app-header">
                    <div style="width: 24px;"></div>
                    <h2>Tienda</h2>
                    <div class="header-actions">
                        <button id="btn-nuevo-pedido-especial-admin" class="icon-btn btn-add-special-pedido" aria-label="Nuevo Pedido Especial">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button id="btn-search-admin" class="icon-btn" aria-label="Buscar">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </header>

                <div class="search-container" id="search-container-admin" style="display: none;">
                    <input type="text" id="search-input-admin" placeholder="Buscar por designaci√≥n, EAN o referencia..." class="search-input">
                    <button id="btn-close-search-admin" class="icon-btn" aria-label="Cerrar b√∫squeda">‚úï</button>
                </div>

                <main class="main-content">
                    <div id="tiendas-list-admin" class="tiendas-grid">
                        <!-- Las tiendas se cargar√°n din√°micamente -->
                    </div>
                </main>

                <div id="cart-button-admin" class="cart-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span id="cart-count-admin" class="cart-count">0</span>
                </div>
            </div>

            <!-- Vista de Pedidos Especiales -->
            <div id="view-admin-pedidos-especiales" class="admin-content-view">
                <header class="app-header">
                    <div style="width: 24px;"></div>
                    <h2>Pedidos Especiales</h2>
                    <div class="header-actions">
                        <button id="btn-nuevo-pedido-especial-admin-pedidos" class="icon-btn btn-add-special-pedido" aria-label="Nuevo Pedido Especial">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </header>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="nuevo-especiales">
                        Nuevo
                        <span class="tab-badge" id="tab-count-nuevo-especiales">0</span>
                    </button>
                    <button class="tab-btn" data-tab="gestionando-especiales">
                        Gestionando
                        <span class="tab-badge" id="tab-count-gestionando-especiales">0</span>
                    </button>
                    <button class="tab-btn" data-tab="sin-transporte-especiales">
                        Pedidos Sin Transporte
                        <span class="tab-badge" id="tab-count-sin-transporte-especiales">0</span>
                    </button>
                    <button class="tab-btn" data-tab="con-transporte-especiales">
                        Pedidos con Transporte
                        <span class="tab-badge" id="tab-count-con-transporte-especiales">0</span>
                    </button>
                    <button class="tab-btn" data-tab="online-especiales">
                        Pedidos Online
                        <span class="tab-badge" id="tab-count-online-especiales">0</span>
                    </button>
                    <button class="tab-btn" data-tab="cerrados-especiales">
                        Cerrados
                        <span class="tab-badge" id="tab-count-cerrados-especiales">0</span>
                    </button>
                </div>

                <main class="main-content">
                    <div id="nuevo-especiales" class="tab-content active">
                        <div id="nuevo-especiales-list" class="pedidos-gestion-list">
                            <!-- Los pedidos nuevos se cargar√°n din√°micamente -->
                        </div>
                        <div id="nuevo-especiales-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos nuevos</p>
                        </div>
                    </div>
                    
                    <div id="sin-transporte-especiales" class="tab-content" style="display: none;">
                        <div id="sin-transporte-especiales-list" class="pedidos-gestion-list">
                            <!-- Los pedidos sin transporte se cargar√°n din√°micamente -->
                        </div>
                        <div id="sin-transporte-especiales-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos sin transporte</p>
                        </div>
                    </div>
                    
                    <div id="con-transporte-especiales" class="tab-content" style="display: none;">
                        <div id="con-transporte-especiales-list" class="pedidos-gestion-list">
                            <!-- Los pedidos con transporte se cargar√°n din√°micamente -->
                        </div>
                        <div id="con-transporte-especiales-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos con transporte</p>
                        </div>
                    </div>
                    
                    <div id="online-especiales" class="tab-content" style="display: none;">
                        <div id="online-especiales-list" class="pedidos-gestion-list">
                            <!-- Los pedidos online se cargar√°n din√°micamente -->
                        </div>
                        <div id="online-especiales-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos online</p>
                        </div>
                    </div>
                    
                    <div id="gestionando-especiales" class="tab-content" style="display: none;">
                        <div id="gestionando-especiales-list" class="pedidos-gestion-list">
                            <!-- Los pedidos gestionando se cargar√°n din√°micamente -->
                        </div>
                        <div id="gestionando-especiales-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos gestionando</p>
                        </div>
                    </div>
                    
                    <div id="cerrados-especiales" class="tab-content" style="display: none;">
                        <!-- Vista de obras -->
                        <div id="cerrados-obras-view" class="cerrados-view">
                            <div id="cerrados-obras-list" class="obras-list">
                                <!-- Las obras se cargar√°n din√°micamente -->
                            </div>
                            <div id="cerrados-obras-empty" class="empty-state" style="display: none;">
                                <p>No hay obras con pedidos cerrados</p>
                            </div>
                        </div>
                        <!-- Vista de pedidos de una obra -->
                        <div id="cerrados-pedidos-view" class="cerrados-view" style="display: none;">
                            <div class="cerrados-pedidos-header">
                                <button id="cerrados-volver-obras" class="btn-volver-obras">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                    Volver a obras
                                </button>
                                <h3 id="cerrados-obra-nombre"></h3>
                            </div>
                            <div id="cerrados-pedidos-list" class="pedidos-gestion-list">
                                <!-- Los pedidos se cargar√°n din√°micamente -->
                            </div>
                            <div id="cerrados-pedidos-empty" class="empty-state" style="display: none;">
                                <p>No hay pedidos cerrados para esta obra</p>
                            </div>
                            <div id="cerrados-cargar-mas-wrapper" style="display: none; text-align: center; margin-top: 1.5rem;">
                                <button id="cerrados-cargar-mas-btn" class="btn-cargar-mas">
                                    Cargar m√°s pedidos
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Vista de Cuentas -->
            <div id="view-admin-cuentas" class="admin-content-view">
                <header class="app-header">
                    <div style="width: 24px;"></div>
                    <h2>Cuentas</h2>
                    <div style="width: 24px;"></div>
                </header>

                <main class="main-content">
                    <!-- Vista de tiendas -->
                    <div id="cuentas-tiendas-view" class="cerrados-view">
                        <div id="cuentas-tiendas-list" class="tiendas-grid">
                            <!-- Las tiendas se cargar√°n din√°micamente -->
                        </div>
                        <div id="cuentas-tiendas-empty" class="empty-state" style="display: none;">
                            <p>No hay tiendas con cuenta</p>
                        </div>
                    </div>
                    <!-- Vista de pedidos de una tienda -->
                    <div id="cuentas-pedidos-view" class="cerrados-view" style="display: none;">
                        <div class="cerrados-pedidos-header">
                            <button id="cuentas-volver-tiendas" class="btn-volver-obras">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                                Volver a cuentas
                            </button>
                            <h3 id="cuentas-tienda-nombre"></h3>
                        </div>
                        <div id="cuentas-pedidos-list" class="pedidos-gestion-list">
                            <!-- Los pedidos se cargar√°n din√°micamente -->
                        </div>
                        <div id="cuentas-pedidos-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos pagados con cuenta para esta tienda</p>
                        </div>
                        <div id="cuentas-cargar-mas-wrapper" style="display: none; text-align: center; margin-top: 1.5rem;">
                            <button id="cuentas-cargar-mas-btn" class="btn-cargar-mas">
                                Cargar m√°s pedidos
                            </button>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Vista de Hist√≥rico -->
            <div id="view-admin-historico" class="admin-content-view">
                <header class="app-header">
                    <div style="width: 24px;"></div>
                    <h2>Hist√≥rico</h2>
                    <div style="width: 24px;"></div>
                </header>

                <main class="main-content">
                    <!-- Vista de obras -->
                    <div id="historico-obras-view" class="cerrados-view">
                        <div id="historico-obras-list" class="obras-list">
                            <!-- Las obras se cargar√°n din√°micamente -->
                        </div>
                        <div id="historico-obras-empty" class="empty-state" style="display: none;">
                            <p>No hay obras con pedidos hist√≥ricos</p>
                        </div>
                    </div>
                    <!-- Vista de pedidos de una obra -->
                    <div id="historico-pedidos-view" class="cerrados-view" style="display: none;">
                        <div class="cerrados-pedidos-header">
                            <button id="historico-volver-obras" class="btn-volver-obras">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                                Volver a cerrados
                            </button>
                            <h3 id="historico-obra-nombre"></h3>
                        </div>
                        <div id="historico-pedidos-list" class="pedidos-gestion-list">
                            <!-- Los pedidos se cargar√°n din√°micamente -->
                        </div>
                        <div id="historico-pedidos-empty" class="empty-state" style="display: none;">
                            <p>No hay pedidos hist√≥ricos para esta obra</p>
                        </div>
                        <div id="historico-cargar-mas-wrapper" style="display: none; text-align: center; margin-top: 1.5rem;">
                            <button id="historico-cargar-mas-btn" class="btn-cargar-mas">
                                Cargar m√°s pedidos
                            </button>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Vista de Gesti√≥n de Usuarios -->
            <div id="view-admin-usuarios" class="admin-content-view">
                <header class="app-header">
                    <button class="icon-btn" aria-label="Volver" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <h2>Gesti√≥n de Usuarios</h2>
                    <button id="btn-nuevo-usuario" class="icon-btn" aria-label="Nuevo Usuario" title="Nuevo Usuario">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </header>

                <main class="main-content">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="tecnicos">T√©cnicos</button>
                        <button class="tab-btn" data-tab="encargados">Encargados</button>
                        <button class="tab-btn" data-tab="tiendas">Tiendas</button>
                        <button class="tab-btn" data-tab="contabilidad">Contabilidad</button>
                    </div>
                    <div id="usuarios-list" class="usuarios-list">
                        <!-- Los usuarios se cargar√°n din√°micamente -->
                    </div>
                    <div id="usuarios-empty" class="empty-state" style="display: none;">
                        <p>No hay usuarios registrados</p>
                    </div>
                </main>
            </div>

            <!-- Vista de Gesti√≥n de Obras -->
            <div id="view-admin-obras" class="admin-content-view">
                <header class="app-header">
                    <button class="icon-btn" aria-label="Volver" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <h2>Gesti√≥n de Obras</h2>
                    <button id="btn-nueva-obra" class="icon-btn" aria-label="Nueva Obra" title="Nueva Obra">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </header>

                <main class="main-content">
                    <div id="obras-list" class="obras-list">
                        <!-- Las obras se cargar√°n din√°micamente -->
                    </div>
                    <div id="obras-empty" class="empty-state" style="display: none;">
                        <p>No hay obras registradas</p>
                    </div>
                </main>
            </div>

            <!-- Vista de Gesti√≥n de Tiendas -->
            <div id="view-admin-tiendas" class="admin-content-view">
                <header class="app-header">
                    <button class="icon-btn" aria-label="Volver" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <h2>Gesti√≥n de Tiendas</h2>
                    <button id="btn-nueva-tienda" class="icon-btn" aria-label="Nueva Tienda" title="Nueva Tienda">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </header>

                <main class="main-content">
                    <div id="tiendas-admin-list" class="tiendas-grid">
                        <!-- Las tiendas se cargar√°n din√°micamente -->
                    </div>
                    <div id="tiendas-admin-empty" class="empty-state" style="display: none;">
                        <p>No hay tiendas registradas</p>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Modales (se incluyen aqu√≠ para que el admin tenga todo lo que necesita) -->
    <!-- Modal: Crear/Editar Usuario -->
    <div id="modal-usuario" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-usuario-titulo">Nuevo Usuario</h3>
                <button class="icon-btn btn-close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-usuario-nombre">Nombre de Usuario</label>
                    <input type="text" id="modal-usuario-nombre" class="form-input" placeholder="Nombre del usuario">
                </div>
                <div class="form-group">
                    <label for="modal-usuario-tipo">Tipo</label>
                    <select id="modal-usuario-tipo" class="form-select">
                        <option value="T√©cnico">T√©cnico</option>
                        <option value="Encargado">Encargado</option>
                        <option value="Tienda">Tienda</option>
                        <option value="Contabilidad">Contabilidad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-usuario-password">Contrase√±a (4 d√≠gitos)</label>
                    <input type="password" id="modal-usuario-password" class="form-input" maxlength="4" pattern="[0-9]{4}" placeholder="0000">
                </div>
                <div id="modal-usuario-tienda-group" class="form-group" style="display: none;">
                    <label for="modal-usuario-tienda">Tienda Asociada</label>
                    <select id="modal-usuario-tienda" class="form-select">
                        <option value="">Seleccione una tienda</option>
                    </select>
                </div>
                <div id="modal-usuario-obras-group" class="form-group" style="display: none;">
                    <label for="modal-usuario-obras">Obras Asignadas</label>
                    <div id="modal-usuario-obras-list" style="margin-bottom: 0.5rem;">
                        <!-- Las obras asignadas se mostrar√°n aqu√≠ -->
                    </div>
                    <select id="modal-usuario-obras-select" class="form-select">
                        <option value="">Seleccione una obra para agregar</option>
                    </select>
                    <button type="button" id="btn-agregar-obra-usuario" class="btn btn-secondary" style="margin-top: 0.5rem; width: 100%;">+ Agregar Obra</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancelar-usuario" class="btn btn-secondary">Cancelar</button>
                <button id="btn-guardar-usuario" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Crear/Editar Obra -->
    <div id="modal-obra" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-obra-titulo">Nueva Obra</h3>
                <button class="icon-btn btn-close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-obra-nombre">Nombre Comercial</label>
                    <input type="text" id="modal-obra-nombre" class="form-input" placeholder="Nombre de la obra">
                </div>
                <div class="form-group">
                    <label for="modal-obra-direccion">Direcci√≥n (Google Maps)</label>
                    <input type="text" id="modal-obra-direccion" class="form-input" placeholder="URL o direcci√≥n de Google Maps">
                </div>
                <div class="form-group">
                    <label for="modal-obra-encargado">Encargado</label>
                    <input type="text" id="modal-obra-encargado" class="form-input" placeholder="Nombre del encargado">
                </div>
                <div class="form-group">
                    <label for="modal-obra-telefono">Tel√©fono del Encargado</label>
                    <input type="tel" id="modal-obra-telefono" class="form-input" placeholder="Tel√©fono">
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancelar-obra" class="btn btn-secondary">Cancelar</button>
                <button id="btn-guardar-obra" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Crear/Editar Tienda -->
    <div id="modal-tienda" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modal-tienda-titulo">Nueva Tienda</h3>
                <button class="icon-btn btn-close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-tienda-nombre">Nombre <span style="color: red;">*</span></label>
                    <input type="text" id="modal-tienda-nombre" class="form-input" placeholder="Nombre de la tienda" required>
                </div>
                <div class="form-group">
                    <label>Logo de la Tienda</label>
                    <div id="modal-tienda-logo-dropzone" class="dropzone" style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                        <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Arrastra el logo aqu√≠ o haz clic para seleccionar</p>
                        <input type="file" id="modal-tienda-logo-file" accept="image/*" style="display: none;">
                        <div id="modal-tienda-logo-preview" style="margin-top: 1rem; display: none;">
                            <img id="modal-tienda-logo-preview-img" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="modal-tienda-sector">Sector</label>
                    <input type="text" id="modal-tienda-sector" class="form-input" placeholder="Ej: Ferreter√≠a, Fontaner√≠a, Pinturas...">
                </div>
                <div class="form-group">
                    <label for="modal-tienda-ubicacion">Ubicaci√≥n</label>
                    <input type="text" id="modal-tienda-ubicacion" class="form-input" placeholder="Ciudad de la tienda">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="modal-tienda-sin-web"> No tiene web
                    </label>
                </div>
                <div id="modal-tienda-web-group" class="form-group">
                    <label for="modal-tienda-web">Web</label>
                    <input type="url" id="modal-tienda-web" class="form-input" placeholder="https://www.ejemplo.com">
                </div>
                <div class="form-group">
                    <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Cuenta:</label>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="modal-tienda-cuenta-tipo" id="modal-tienda-no-cuenta" value="no-cuenta">
                            <span>No tiene cuenta</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="modal-tienda-cuenta-tipo" id="modal-tienda-sin-limite" value="sin-limite">
                            <span>Sin l√≠mite de cuenta</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="radio" name="modal-tienda-cuenta-tipo" id="modal-tienda-tiene-cuenta" value="con-limite">
                            <span>Tiene cuenta con l√≠mite</span>
                        </label>
                    </div>
                </div>
                <div id="modal-tienda-limite-group" class="form-group" style="display: none;">
                    <label for="modal-tienda-limite">L√≠mite de Cuenta (‚Ç¨)</label>
                    <input type="number" id="modal-tienda-limite" class="form-input" placeholder="4000" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="modal-tienda-contactos">Personas de Contacto</label>
                    <textarea id="modal-tienda-contactos" class="form-input" rows="3" placeholder="Manuel | Compras Leroy Merlin | 651228353&#10;Mar√≠a | Ventas | 612345678"></textarea>
                    <small style="color: var(--text-secondary); font-size: 0.875rem;">Una por l√≠nea. Formato: Nombre | Cargo | Tel√©fono</small>
                </div>
                <div class="form-group">
                    <label for="modal-tienda-notas">Notas</label>
                    <textarea id="modal-tienda-notas" class="form-input" rows="3" placeholder="Notas adicionales sobre la tienda"></textarea>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="modal-tienda-activa" checked>
                        <span>Tienda activa (visible para t√©cnicos y encargados)</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancelar-tienda" class="btn btn-secondary">Cancelar</button>
                <button id="btn-guardar-tienda" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Subir Art√≠culos de Tienda -->
    <div id="modal-subir-articulos" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modal-subir-articulos-titulo">Subir Base de Datos de Art√≠culos</h3>
                <button class="icon-btn btn-close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Formato del archivo</label>
                    <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">
                        Puedes subir un archivo JSON, CSV o Excel con los art√≠culos. El formato Excel debe tener las columnas: Categor√≠a, Sub Categor√≠a (opcional), Designaci√≥n, Referencia, EAN, Descripci√≥n, Precio, URL Foto.
                    </p>
                </div>
                <div class="form-group">
                    <label>Archivo de Art√≠culos</label>
                    <div id="modal-subir-articulos-dropzone" class="dropzone" style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                        <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Arrastra el archivo aqu√≠ o haz clic para seleccionar</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">JSON, CSV o Excel (.xlsx, .xls) (m√°x. 10MB)</p>
                        <input type="file" id="modal-subir-articulos-file" accept=".json,.csv,.xlsx,.xls,application/json,text/csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" style="display: none;">
                        <div id="modal-subir-articulos-preview" style="margin-top: 1rem; display: none;">
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem; background: var(--card-bg); border-radius: 4px;">
                                <span id="modal-subir-articulos-nombre"></span>
                                <button type="button" id="btn-remove-articulos-file" class="btn btn-secondary btn-sm">‚úï</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-subir-articulos-progress" style="display: none;">
                    <div style="background: var(--bg-color); border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                        <p style="margin-bottom: 0.5rem;">Procesando art√≠culos...</p>
                        <div style="background: var(--border-color); border-radius: 4px; height: 8px; overflow: hidden;">
                            <div id="modal-subir-articulos-progress-bar" style="background: var(--primary-color); height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <p id="modal-subir-articulos-status" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);"></p>
                    </div>
                </div>
                <div id="modal-subir-articulos-resultado" style="display: none; margin-top: 1rem; padding: 1rem; border-radius: 8px; background: var(--card-bg);">
                    <p id="modal-subir-articulos-mensaje"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancelar-subir-articulos" class="btn btn-secondary">Cancelar</button>
                <button id="btn-subir-articulos" class="btn btn-primary" disabled>Subir Art√≠culos</button>
            </div>
        </div>
    </div>

    <!-- Modal: Crear Pedido Especial -->
    <div id="modal-pedido-especial" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Nuevo Pedido Especial</h3>
                <button class="icon-btn btn-close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="pedido-especial-proveedor-nombre">T√≠tulo del pedido <span style="color: red;">*</span> <span id="pedido-especial-titulo-count" style="color: var(--text-secondary); font-size: 0.85rem; font-weight: normal;">(0/60)</span></label>
                    <input type="text" id="pedido-especial-proveedor-nombre" class="form-input" placeholder="T√≠tulo del pedido especial" maxlength="60" required>
                </div>
                <div class="form-group">
                    <label for="pedido-especial-obra">Obra <span style="color: red;">*</span></label>
                    <select id="pedido-especial-obra" class="form-select" required>
                        <option value="">-- Selecciona una obra --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Art√≠culos</label>
                    <div id="pedido-especial-articulos" class="modal-pedido-especial-items">
                        <!-- Los art√≠culos se a√±adir√°n din√°micamente -->
                    </div>
                    <button type="button" id="btn-add-articulo-especial" class="btn btn-secondary" style="margin-top: 0.5rem;">
                        + A√±adir Art√≠culo
                    </button>
                </div>
                <div class="form-group">
                    <label>Adjuntar Documento de Pago</label>
                    <div id="pedido-especial-documento-dropzone" class="dropzone" style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                        <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Arrastra un documento aqu√≠ o haz clic para seleccionar</p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">PDF, PNG, JPG (m√°x. 10MB)</p>
                        <input type="file" id="pedido-especial-documento-file" accept="application/pdf,image/png,image/jpeg,image/jpg" style="display: none;">
                        <div id="pedido-especial-documento-preview" style="margin-top: 1rem; display: none;">
                            <div class="pedido-especial-documento-preview">
                                <span id="pedido-especial-documento-nombre"></span>
                                <button type="button" id="btn-remove-documento-especial" class="btn btn-secondary btn-sm">‚úï</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pedido-especial-notas">Notas del pedido</label>
                    <textarea id="pedido-especial-notas" class="form-input" rows="3" placeholder="Notas adicionales sobre el pedido (opcional)"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancelar-pedido-especial" class="btn btn-secondary">Cancelar</button>
                <button id="btn-guardar-pedido-especial" class="btn btn-primary">Guardar Pedido</button>
            </div>
        </div>
    </div>

    <!-- Modal: A√±adir Art√≠culo al Pedido Especial -->
    <div id="modal-add-articulo-especial" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>A√±adir Art√≠culo</h3>
                <button class="icon-btn btn-close-modal-articulo">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="articulo-especial-nombre">Nombre del Art√≠culo <span style="color: red;">*</span></label>
                    <input type="text" id="articulo-especial-nombre" class="form-input" placeholder="Nombre del art√≠culo" required>
                </div>
                <div class="form-group">
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <div style="flex: 0 0 120px;">
                            <label>Foto</label>
                            <div id="articulo-especial-foto-dropzone" class="articulo-foto-dropzone-square" style="width: 120px; height: 120px; border: 2px dashed var(--border-color); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; background-color: var(--bg-color); transition: all 0.2s; position: relative;">
                                <input type="file" id="articulo-especial-foto-file" accept="image/png,image/jpeg,image/jpg" style="display: none;">
                                <div id="articulo-especial-foto-placeholder" style="text-align: center;">
                                    <span style="font-size: 2rem;">üì∑</span>
                                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">Foto</p>
                                </div>
                                <img id="articulo-especial-foto-preview" style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">
                                <button type="button" id="articulo-especial-foto-remove" style="display: none; position: absolute; top: -8px; right: -8px; background: var(--danger-color); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 0.875rem; z-index: 10;">‚úï</button>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label for="articulo-especial-cantidad">Cantidad</label>
                                <input type="number" id="articulo-especial-cantidad" class="form-input" placeholder="Cantidad" step="1" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label for="articulo-especial-precio">Precio (‚Ç¨) <span style="color: var(--text-secondary); font-size: 0.875rem;">(opcional)</span></label>
                                <input type="number" id="articulo-especial-precio" class="form-input" placeholder="Precio" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="articulo-especial-descripcion">Descripci√≥n <span style="color: var(--text-secondary); font-size: 0.875rem;">(opcional)</span></label>
                                <textarea id="articulo-especial-descripcion" class="form-input" rows="2" placeholder="Descripci√≥n del art√≠culo (opcional)"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancelar-articulo-especial" class="btn btn-secondary">Cancelar</button>
                <button id="btn-guardar-articulo-especial" class="btn btn-primary">A√±adir Art√≠culo</button>
            </div>
        </div>
    </div>

    <!-- Popups personalizados -->
    <div id="custom-alert" class="custom-popup">
        <div class="custom-popup-overlay"></div>
        <div class="custom-popup-content">
            <div class="custom-popup-header">
                <h3 id="custom-alert-title">Informaci√≥n</h3>
            </div>
            <div class="custom-popup-body">
                <p id="custom-alert-message"></p>
            </div>
            <div class="custom-popup-footer">
                <button id="custom-alert-ok" class="btn btn-primary">Aceptar</button>
            </div>
        </div>
    </div>

    <div id="custom-confirm" class="custom-popup">
        <div class="custom-popup-overlay"></div>
        <div class="custom-popup-content">
            <div class="custom-popup-header">
                <h3 id="custom-confirm-title">Confirmar</h3>
            </div>
            <div class="custom-popup-body">
                <p id="custom-confirm-message"></p>
            </div>
            <div class="custom-popup-footer">
                <button id="custom-confirm-cancel" class="btn btn-secondary">Cancelar</button>
                <button id="custom-confirm-ok" class="btn btn-primary">Aceptar</button>
            </div>
        </div>
    </div>

    <div id="custom-prompt" class="custom-popup">
        <div class="custom-popup-overlay"></div>
        <div class="custom-popup-content">
            <div class="custom-popup-header">
                <h3 id="custom-prompt-title">Ingresar</h3>
            </div>
            <div class="custom-popup-body">
                <p id="custom-prompt-message"></p>
                <input type="text" id="custom-prompt-input" class="form-input" style="margin-top: 1rem;">
            </div>
            <div class="custom-popup-footer">
                <button id="custom-prompt-cancel" class="btn btn-secondary">Cancelar</button>
                <button id="custom-prompt-ok" class="btn btn-primary">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Carrito -->
    <div id="modal-carrito-admin" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Carrito de Compras</h3>
                <button class="icon-btn btn-close-modal">‚úï</button>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <div id="carrito-items-admin" class="carrito-items">
                    <!-- Los items del carrito se cargar√°n din√°micamente -->
                </div>
                <div id="carrito-empty-admin" class="empty-state" style="display: none; text-align: center; padding: 2rem;">
                    <p style="color: var(--text-secondary);">El carrito est√° vac√≠o</p>
                </div>
            </div>
            <div class="modal-footer carrito-footer">
                <div class="carrito-total-container">
                    <div class="carrito-total-label">Total del pedido</div>
                    <div class="carrito-total-value" id="carrito-total-admin">0.00 ‚Ç¨</div>
                </div>
                <button id="btn-finalizar-pedido-admin" class="btn btn-primary btn-block btn-finalizar-pedido" disabled>Enviar Pedido</button>
            </div>
        </div>
    </div>

    <!-- Firebase Config debe cargarse primero -->
    <!-- IMPORTANTE: firebase-config.js est√° en .gitignore y contiene las credenciales reales -->
    <!-- Si no existe, copia firebase-config.example.js como firebase-config.js y configura tus credenciales -->
    <script src="../firebase-config.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script type="module" src="admin.js"></script>
</body>
</html>


